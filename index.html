<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For Alya ‚ù§Ô∏è</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß∏</text></svg>">    
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Sacramento&display=swap');

        /* --- RESET & CORE --- */
        html { scroll-snap-type: y mandatory; scroll-behavior: smooth; }
        body { margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; background-color: #000; color: white; overflow-x: hidden; transition: background 1s ease; }
        
        @media (max-width: 768px) {
        /* Make decos visible on mobile without hovering */
        .deco { opacity: 0.7 !important; filter: grayscale(0%) !important; }
        /* Adjust text sizes for smaller screens */
        h1 { font-size: 1.5rem; }
        .ticket { transform: scale(0.95); margin: 5px 0; }
}

        section {
            height: 100dvh; width: 100vw;
            scroll-snap-align: start; scroll-snap-stop: always;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
            position: relative; padding: 10px; box-sizing: border-box;
            background: #121212; overflow: hidden; 
        }
        #secret-section { height: 100dvh; display: none; justify-content: center; align-items: center; background: #000; scroll-snap-align: start; }

        /* --- DECORATIONS --- */
        .deco { position: absolute; font-size: 2.5rem; opacity: 0.3; filter: grayscale(100%); transition: 0.5s; cursor: default; z-index: 1; pointer-events: none; }
        section:hover .deco { opacity: 0.8; filter: grayscale(0%); pointer-events: auto; }
        .deco:hover { transform: scale(1.2) rotate(10deg); opacity: 1; }
        #secret-deco { cursor: pointer; }

        /* --- NEW MAP WIDGET STYLES --- */
        #distance-section {
            background: #5a595d; /* Dark Night Sky color */
            position: relative;
            overflow: hidden;
        }

       /* --- FIXED MAP WIDGET CONTAINER --- */
        .map-widget {
            position: relative;
            width: 95%;             /* Flexible on mobile */
            max-width: 300px;       /* PREVENTS IT BEING TOO BIG ON PC */
            aspect-ratio: 1 / 1;    /* Keeps it square and contained */
            margin: 20px auto;       
            
            /* Background Map */
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png');
            background-size: 600%;  /* High zoom for detail */
            background-position: 72% 35%; 
            background-color: #ffffff; 
            background-blend-mode: luminosity;

            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid #444;
        }

        /* Fix the Line size */
        .connection-svg {
            position: absolute;
            top: 0; left: 0; 
            width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .dashed-path {
            fill: none;
            stroke: #ffffff; 
            stroke-width: 3; /* Thickness adjusted for zoom */
            stroke-dasharray: 10, 8; 
            animation: dashScroll 20s linear infinite;
        }

        /* Ensure the distance bubble is inside and at the bottom */
        .distance-bubble {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: #289057;
            color: rgb(255, 255, 255);
            padding: 8px 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 5px;
        }


        /* The Animated Line (SVG) */
        connection-svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            overflow: visible; /* Allow glow to spill out */
        }

        .dashed-path {
            fill: none;
            stroke: #000000; /* Soft Purple/Blue */
            stroke-width: 1;
            stroke-dasharray: 3, 4; /* Creates the dashes */
            animation: dashScroll 20s linear infinite; /* Moves the dashes */
            filter: drop-shadow(0 0 5px #a29bfe);
        }

        @keyframes dashScroll {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -200; }
        }

        /* --- NEW PIN DESIGN (Marker Style) --- */

        /* The main circular head of the pin */
        .map-pin {
            position: absolute;
            width: 50px;
            height: 50px;
            /* This background color acts as the border */
            background: #ffffff; 
            padding: 3px; /* Thickness of the border ring */
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            z-index: 2;
            animation: floatPin 3s ease-in-out infinite;
        }

        /* The image inside the pin */
        .map-pin img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            display: block;
            /* Optional: A tiny inner border to separate img from ring */
            border: 1px solid rgba(60, 11, 11, 0.1); 
        }

        /* THE "MISSING ARROW" (Pointy tip at bottom) */
        .map-pin::after {
            content: '';
            position: absolute;
            bottom: -12px; /* Hangs below the circle */
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            /* CSS Triangle Hack */
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            /* The color of the arrow must match the main pin background */
            border-top: 14px solid #433f3f; 
        }

        /* --- COLOR VARIATIONS --- */

        /* UAE Pin (Alya) - Default White/Pink */
        .pin-uae {
            top: 1%; left: 7%; /* Keep your current positions */
            background: #f598e8; /* Soft pink border ring */
        }
        .pin-uae::after {
            border-top-color: #000000; /* Match the arrow color */
        }

        /* MY Pin (Akmal) - Spotify Green */
        .pin-my {
            top: 60%; left: 84%; /* Keep your current positions */
            background: #eff7f2; /* Green border ring */
            animation-delay: 1.5s;
        }
        .pin-my::after {
            border-top-color: #1c221e; /* Match the green arrow */
        }


        /* --- UPDATED LABELS & ANIMATION --- */

        .pin-label {
            position: absolute;
            /* Pushed down further to clear the new arrow tip */
            bottom: -35px; 
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            white-space: nowrap;
            text-shadow: 0 2px 4px black;
            background: rgba(0,0,0,0.5); /* Small dark background for readability */
            padding: 2px 8px;
            border-radius: 10px;
        }

        @keyframes floatPin {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* --- 1. NEW FEATURE: CURSOR TRAIL --- */
        .cursor-heart { position: fixed; pointer-events: none; color: #1DB954; font-size: 1.2rem; z-index: 20000; user-select: none; animation: flyOut 1s forwards; }
        @keyframes flyOut { to { transform: translateY(-60px) scale(2); opacity: 0; } }

        /* --- 2. NEW FEATURE: CSS CAKE STYLES --- */
        .cake-wrapper { position: relative; margin-top: 60px; transform: scale(0.8); transition: 0.5s; }
        .cake { position: absolute; width: 250px; height: 200px; top: 50%; left: 50%; margin-top: -70px; margin-left: -125px; }
        .plate { width: 270px; height: 110px; position: absolute; bottom: -10px; left: -10px; background-color: #ccc; border-radius: 50%; box-shadow: 0 2px 0 #b3b3b3, 0 4px 0 #b3b3b3, 0 5px 40px rgba(0, 0, 0, 0.5); }
        .cake > * { position: absolute; }
        .layer { position: absolute; display: block; width: 250px; height: 100px; border-radius: 50%; background-color: #553c13; box-shadow: 0 2px 0px #6a4b18, 0 4px 0px #33240b, 0 6px 0px #32230b, 0 8px 0px #31230b, 0 10px 0px #30220b, 0 12px 0px #2f220b, 0 14px 0px #2f210b, 0 16px 0px #2e200b, 0 18px 0px #2d200b, 0 20px 0px #2c1f0b, 0 22px 0px #2b1f0b, 0 24px 0px #2a1e0b, 0 26px 0px #2a1d0b, 0 28px 0px #291d0b, 0 30px 0px #281c0b; }
        .layer-top { top: 0px; }
        .layer-middle { top: 33px; }
        .layer-bottom { top: 66px; }
        .icing { top: 2px; left: 5px; background-color: #f0e4d0; width: 240px; height: 90px; border-radius: 50%; position: absolute; z-index: 1; }
        .icing:before { content: ""; position: absolute; top: 4px; right: 5px; bottom: 6px; left: 5px; background-color: #f4ebdc; box-shadow: 0 0 4px #f6efe3, 0 0 4px #f6efe3, 0 0 4px #f6efe3; border-radius: 50%; z-index: 1; }
        .drip { display: block; width: 50px; height: 60px; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; background-color: #f0e4d0; position: absolute; top: 50px; z-index: 1; }
        .drip1 { left: 10px; height: 40px; width: 40px; }
        .drip2 { left: 60px; height: 30px; width: 50px; }
        .drip3 { left: 120px; height: 35px; width: 40px; }
        .drip4 { left: 170px; height: 45px; width: 30px; }
        /* CANDLES */
        .candle { background-color: #7B020B; width: 12px; height: 35px; border-radius: 6px/3px; position: absolute; top: -15px; z-index: 10; box-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .candle:before { content: ""; position: absolute; top: 0; left: 0; width: 12px; height: 6px; border-radius: 50%; background-color: #ad030f; }
        .candle:after { content: ""; position: absolute; top: -5px; left: 5px; width: 2px; height: 10px; background: black; }
        .c1 { left: 30px; top: 10px; }
        .c2 { left: 75px; top: 15px; }
        .c3 { left: 115px; top: 5px; }
        .c4 { left: 155px; top: 15px; }
        .c5 { left: 200px; top: 10px; }
        /* FLAMES */
        .fuego { position: absolute; top: -15px; left: 3px; width: 6px; height: 12px; border-radius: 50%; background: #ffcc00; box-shadow: 0 0 10px gold, 0 0 20px #ffcc00, 0 0 20px #ff0000; animation: flicker 0.5s infinite alternate; transform-origin: center bottom; opacity: 1; transition: 0.5s; }
        .fuego:before { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 30%; background: #ff0000; border-radius: 50%; opacity: 0.7; }
        @keyframes flicker { 0% { transform: scale(1) rotate(-2deg); } 100% { transform: scale(1.1) rotate(2deg); } }
        /* BLOWN OUT */
        .fuego.out { opacity: 0; transform: scale(0.1); }
        .smoke { position: absolute; top: -25px; left: 0; width: 10px; height: 20px; background: rgba(200,200,200,0.5); border-radius: 50%; animation: smokeRise 1s forwards; opacity: 0; pointer-events: none; }
        @keyframes smokeRise { 0% { opacity: 0.8; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-30px) scale(2); } }

        /* --- OVERLAYS --- */
        #login-screen, #pearl-overlay, #fog-modal, #contract-reveal, #custom-alert-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000; transition: opacity 0.5s; background: #000; 
        }
        #pearl-overlay { display: none; }
        #fog-modal { background: rgba(0,0,0,0.9); z-index: 10001; display: none; }
        #contract-reveal { display: none; background: rgba(0,0,0,0.95); z-index: 11000; }
        #custom-alert-overlay { background: rgba(0,0,0,0.8); display: none; z-index: 12000; }
        #fireworks-canvas { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 10500; pointer-events: none; display: none; }

        /* --- UI ELEMENTS --- */
        .login-input { padding: 10px; border-radius: 30px; border: 1px solid #333; background: #2a2a2a; color: white; text-align: center; font-family: 'Courier Prime'; width: 200px; outline: none; }
        .btn-spotify { margin-top: 15px; padding: 12px 30px; border-radius: 30px; background: #1DB954; color: black; font-weight: bold; border: none; cursor: pointer; transition: 0.3s; text-transform: uppercase; box-shadow: 0 4px 15px rgba(29, 185, 84, 0.4); }
        .btn-spotify:hover { transform: scale(1.05); background: #1ed760; }
        .btn-pink { background: #ff4757; color: white; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4); }
        .pearl-img { width: 180px; height: 180px; border-radius: 50%; border: 4px solid #ff4757; box-shadow: 0 0 20px #ff4757; margin-bottom: 20px; object-fit: cover; }

        /* --- COMPONENTS --- */
        h1 { font-size: 1.8rem; margin: 10px 0; font-weight: 900; z-index: 2; }
  
        /* --- DISTANCE SECTION (FIXED WIDTHS & PLANES) --- */
        .bg-distance-color { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; transition: background 1s ease; }
        .bg-distance-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1; pointer-events: none; }
        .night-mode-active .bg-distance-color { background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%) !important; }
        .night-mode-active .bg-distance-overlay { opacity: 0.8; }
        .night-mode-active .distance-content { opacity: 0.1; filter: blur(5px); pointer-events: none; transition: 0.5s; }
        .distance-content { gap: 15px; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 100%; } 

        /* Change this from column to row */
        .clock-column {
            display: flex;
            flex-direction: row; /* This puts them side-by-side */
            justify-content: center; /* Centers them in the middle of the screen */
            gap: 15px; /* Adds space between the two clocks */
            width: 100%;
            margin-bottom: 20px;
        }

        /* Ensure individual boxes have a set width so they look uniform */
        .clock-box {
            flex: 1; /* Makes both boxes the same width */
            max-width: 180px; /* Adjust this to make the boxes wider or thinner */
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .time-text { font-size: 1.2rem; font-weight: bold; font-family: 'Courier Prime';color: #fefefe; }
        .loc-text { font-size: 0.6rem; color: #e0e0e0; letter-spacing: 1px; margin-top: 5px; }

        /* --- TICKETS STACKED & OVERLAPPING --- */
        .ticket-container { 
            display: flex; 
            flex-direction: column; 
            gap: 0px; /* Reduced gap because we are using margins to overlap */
            z-index: 2; 
            width: 100%; 
            align-items: center; 
            position: relative; 
            margin-top: 40px; 
        }

        .ticket { 
            background: linear-gradient(to right, #ffffff, #f0f2f5); 
            color: black; 
            width: 95%; 
            max-width: 450px; 
            border-radius: 12px; 
            overflow: hidden; 
            display: flex; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); 
            position: relative; 
            transition: all 0.3s ease; /* Smooth move when hovering */
        }

        /* THE STACKING TRICK */
        /* This selects any ticket that follows another ticket */
        .ticket + .ticket {
            margin-top: -50px;
            margin-right: 50px; /* Pulls the second ticket UP to overlap the first */
        }

        /* ROTATION FOR THE "MESSY" LOOK */
        .ticket:nth-child(1) { transform: rotate(-1.5deg); z-index: 1; }
        .ticket:nth-child(2) { transform: rotate(2deg); z-index: 2; }

        /* HOVER EFFECT: Lift the ticket when Alya touches it */
        .ticket:hover {
            transform: translateY(-20px) scale(1.03) rotate(0deg) !important;
            z-index: 10; /* Brings it to the very front */
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
        }

        .ticket-left { padding: 15px; flex: 2; border-right: 2px dashed #ccc; text-align: left; position: relative; }
        .ticket-right { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #1DB954; color: white; }
        .ticket-val { font-size: 1rem; font-weight: bold; margin-bottom: 2px; font-family: 'Courier Prime'; }
        .ticket-flight { display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 900; margin: 5px 0; }
        .ticket-sticker { position: absolute; top: 5px; right: 10px; width: 35px; height: 35px; opacity: 0.8; }

        .quest-container { width: 95%; max-width: 450px; /* WIDER */ z-index: 2; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px; margin-top: 10px; }
        .quest-item { background: rgba(0,0,0,0.5); padding: 10px; margin: 5px 0; border-radius: 8px; border-left: 3px solid #555; text-align: left; display: flex; align-items: center; font-size: 0.85rem; }
        .quest-item:hover { border-left-color: #1DB954; }
        .quest-checkbox { min-width: 20px; height: 20px; border: 2px solid #1DB954; border-radius: 50%; margin-right: 10px; display: flex; justify-content: center; align-items: center; color: black; font-weight: bold; font-size: 0.7rem; }
        .quest-done { opacity: 0.8; }
        .quest-done .quest-checkbox { background: #1DB954; }
        .quest-active { border-left-color: #ff00de; background: rgba(255, 0, 222, 0.1); }

        .moonlight-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; text-align: center; opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 20; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); padding: 30px; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .night-mode-active .moonlight-msg { opacity: 1; pointer-events: auto; }
        .night-mode-btn { z-index: 5; background: rgba(0,0,0,0.5); border: 1px solid white; color: white; padding: 10px 25px; font-size: 0.9rem; cursor: pointer; border-radius: 30px; margin-top: 20px; }

        /* --- NEW PLANE ANIMATIONS (MIDDLE LOOPING) --- */
        .plane-wrapper { position: absolute; width: 100%; height: 220px; top: 50%; transform: translateY(-50%); z-index: 1; pointer-events: none; }
        
        /* Top Plane: Middle -> Left -> Loop back Right -> Middle */
        .plane-top { position: absolute; top: 10px; left: 50%; font-size: 3rem; animation: flyLoopLeft 15s linear infinite; transform: scaleX(-1); opacity: 0; }
        @keyframes flyLoopLeft {
            0% { left: 50%; opacity: 0; } 10% { opacity: 1; }
            45% { left: -10%; } 45.01% { left: 110%; }
            100% { left: 50%; opacity: 1; }
        }
        /* Bottom Plane: Middle -> Right -> Loop back Left -> Middle */
        .plane-bottom { position: absolute; bottom: 10px; left: 50%; font-size: 3rem; animation: flyLoopRight 15s linear infinite; opacity: 0; }
        @keyframes flyLoopRight {
            0% { left: 50%; opacity: 0; } 10% { opacity: 1; }
            45% { left: 110%; } 45.01% { left: -10%; }
            100% { left: 50%; opacity: 1; }
        }

        /* --- RETRACTABLE MUSIC PLAYER --- */
        #music-container { position: fixed; bottom: 20px; right: 20px; z-index: 9000; display: flex; align-items: center; }
        .music-bar { background: rgba(24, 24, 24, 0.95); backdrop-filter: blur(10px); border: 1px solid #333; padding: 10px 20px; border-radius: 50px; display: flex; align-items: center; gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 280px; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden; }
        .music-bar.retracted { width: 50px; height: 50px; padding: 0; justify-content: center; border-radius: 50%; cursor: pointer; }
        .music-bar.retracted > *:not(.retracted-icon) { display: none !important; }
        .retracted-icon { display: none; font-size: 1.5rem; animation: spinMusic 3s linear infinite; }
        .music-bar.retracted .retracted-icon { display: block; }
        @keyframes spinMusic { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .album-art { width: 35px; height: 35px; border-radius: 50%; background: #333; overflow: hidden; animation: spin 4s linear infinite; animation-play-state: paused; min-width: 35px; }
        .play-active .album-art { animation-play-state: running; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .vol-slider { width: 60px; height: 4px; appearance: none; background: #555; border-radius: 2px; outline: none; }
        .vol-slider::-webkit-slider-thumb { appearance: none; width: 12px; height: 12px; border-radius: 50%; background: #1DB954; cursor: pointer; }

        /* --- UPDATED: MUSIC BAR LAYOUT --- */
        .music-bar {
            background: rgba(24, 24, 24, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px; /* Reduced overall gap */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 280px; 
            transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* CRITICAL FIX: Allow popup to show outside the bar */
            overflow: visible !important; 
        }

        .music-bar.retracted {
            width: 50px;
            height: 50px;
            padding: 0;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            overflow: hidden !important; /* Hide contents when closed */
        }

        /* --- SCROLLING TEXT FIX --- */
        .track-info-container {
            flex: 1;
            min-width: 0;
            margin-right: 10px;
            position: relative;
            height: 35px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden; 
            mask-image: linear-gradient(to right, black 85%, transparent 100%); /* Fades text out at the end */
            -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
        }

        .scrolling-text {
            white-space: nowrap;
            position: relative; /* Changed from absolute to keep flow */
            animation: scroll-left 12s linear infinite;
        }

        /* Scroll Animation: Visible -> Scroll Left -> Snap Back */
        @keyframes scroll-left {
            0%, 15% { transform: translateX(0%); } /* Start visible & wait */
            50% { transform: translateX(-100%); } /* Scroll all the way out */
            50.01% { transform: translateX(100%); } /* Snap to right side instantly */
            100% { transform: translateX(0%); } /* Scroll back in from right */
        }

       /* --- UPDATED ANIMATION: Middle -> Left, then Right -> Middle --- */
        @keyframes scroll-left {
            /* 1. Start: Sit in the middle (visible) */
            0%, 15% { 
                transform: translateX(0%); 
            }
            
            /* 2. Scroll OUT to the LEFT */
            45% { 
                transform: translateX(-100%); 
            }
            
            /* 3. Magic Teleport: Jump to the RIGHT instantly (while off-screen) */
            45.01% { 
                transform: translateX(100%); 
            }
            
            /* 4. Scroll IN from the RIGHT back to Middle */
            85%, 100% { 
                transform: translateX(0%); 
            }
        }

        /* --- TIGHTER BUTTON GROUP --- */
        .controls-group {
            display: flex;
            align-items: center;
            gap: 8px; /* Closer buttons */
            margin-right: 5px;
        }

        .control-btn {
            background: none;
            border: none;
            color: #1DB954;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
            padding: 0; /* Remove default padding */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .control-btn:hover { color: white; transform: scale(1.1); }

        /* --- VERTICAL VOLUME POPUP --- */
        .volume-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .volume-popup {
            position: absolute;
            bottom: 45px; /* Push it above the bar */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.95);
            padding: 15px 10px;
            border-radius: 20px;
            border: 1px solid #333;
            display: none;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.6);
            z-index: 10000;
            width: 30px;
            height: 120px;
        }

        .volume-popup.show {
            display: flex;
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* The Vertical Slider */
        .vol-slider {
            writing-mode: bt-lr; /* IE/Edge */
            appearance: slider-vertical; /* Chrome/Safari/Edge */
            width: 8px;
            height: 100px;
            background: #444;
            outline: none;
            cursor: pointer;
            border-radius: 5px;
        }

        @keyframes popUp {
            from { opacity: 0; transform: translate(-50%, 20px) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, 0) scale(1); }
        }

        /* UTILS */
        .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 95%; max-width: 450px; }
        .gallery-img { width: 100%; height: 150px; object-fit: cover; border-radius: 10px; background: #333; transition: transform 0.3s; }
        .gallery-img:hover { transform: scale(1.05); z-index: 2; }

        #garden { width: 100%; height: 150px; border-bottom: 3px solid #ff4757; position: relative; margin-top: 20px; overflow: hidden; }
        .flower { position: absolute; bottom: -50px; font-size: 3rem; animation: growUp 0.8s forwards; cursor: pointer; z-index: 5; }
        @keyframes growUp { to { bottom: 10px; } }
        .plus-one { position: absolute; color: #1DB954; font-weight: bold; font-size: 1.5rem; pointer-events: none; animation: floatUp 1s forwards; z-index: 10; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        #flower-toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(29, 185, 84, 0.9); color: white; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 6000; }
        
        .dose-box { width: 95%; max-width: 450px; border: 2px dashed #555; border-radius: 15px; padding: 25px; margin-bottom: 30px; background: rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; }

        /* --- TEXT SCROLLING (MARQUEE) --- */
        .track-info-container {
            flex: 1;
            overflow: hidden; /* Mask the scrolling text */
            margin-right: 10px;
            position: relative;
            height: 35px; /* Fixed height for text area */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .scrolling-text {
            white-space: nowrap;
            position: absolute;
            animation: scroll-left 10s linear infinite; /* Adjust speed here */
            transform: translateX(0%);
        }

        /* Pause scrolling on hover so user can read */
        .track-info-container:hover .scrolling-text {
            animation-play-state: paused;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0%); }
            20% { transform: translateX(0%); } /* Pause at start */
            100% { transform: translateX(-100%); }
        }

        /* --- BUTTON GROUPING --- */
        .controls-group {
            display: flex;
            align-items: center;
            gap: 15px; /* Space between Prev, Play, Next */
            margin-right: 15px;
        }

        /* --- VOLUME POPUP --- */
        .volume-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .volume-popup {
            position: absolute;
            bottom: 140%; /* Position above the icon */
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #333;
            display: none; /* Hidden by default */
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .volume-popup.show {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.2s ease;
        }

        /* Vertical slider styling */
        .vol-slider {
            width: 6px;
            height: 80px; /* Make it vertical height */
            appearance: slider-vertical; /* Standard vertical slider */
            background: #555;
            outline: none;
            cursor: pointer;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translate(-50%, 10px); } to { opacity: 1; transform: translate(-50%, 0); } }

        /* --- MOOD RING & TOOLTIPS (NEW) --- */
        .mood-ring { display: flex; gap: 25px; margin-top: 15px; }
        .mood-item { position: relative; display: inline-block; }
        .mood-btn { font-size: 2.5rem; cursor: pointer; transition: 0.3s; filter: grayscale(1); }
        .mood-btn:hover { filter: grayscale(0); transform: scale(1.2); }
        .mood-tooltip {
            visibility: hidden; width: 120px; background-color: #333; color: #fff; text-align: center;
            border-radius: 6px; padding: 5px 0; position: absolute; z-index: 3;
            bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s;
            font-size: 0.7rem; pointer-events: none;
        }
        .mood-tooltip::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent;
        }
        .mood-item:hover .mood-tooltip { visibility: visible; opacity: 1; }


        /* SPOTIFY CARD UPDATED */
        .wrapped-card { width: 90%; max-width: 350px; height: 520px; background: linear-gradient(135deg, #8f33a2, #e45c6e, #f544b4); border-radius: 20px; padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 20px 50px rgba(0,0,0,0.5); text-align: left; position: relative; overflow: hidden; }
        .counter-subtext { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; font-family: 'Courier Prime'; }

        .voice-capsule { width: 140px; height: 140px; border-radius: 50%; background: #222; border: 3px solid #1DB954; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: 0.3s; margin-top: 20px; position: relative; overflow: hidden; box-shadow: 0 0 15px rgba(29, 185, 84, 0.5); }
        .voice-capsule:hover { transform: scale(1.05); }
        .voice-waves { height: 40px; display: flex; align-items: center; gap: 3px; }
        .bar { width: 4px; height: 10px; background: #555; border-radius: 2px; animation: none; }
        .voice-active .bar { background: #1DB954; animation: wave 0.5s ease-in-out infinite; }
        @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 30px; } }

        #scratch-container { position: relative; width: 300px; height: 300px; border-radius: 15px; overflow: hidden; border: 2px solid #555; }
        .fog-glow { animation: glow 2s infinite alternate; border-color: #1DB954 !important; }
        @keyframes glow { from { box-shadow: 0 0 10px #1DB954; } to { box-shadow: 0 0 30px #1DB954, 0 0 50px #1DB954; } }

        /* --- CONTRACT STYLING (FIXED OVERLAP) --- */
        .contract-paper { background: #fdfdfd; color: #121212; padding: 40px 30px 60px 30px; width: 85%; max-width: 450px; border-radius: 5px; font-family: 'Courier Prime', monospace; box-shadow: 0 0 50px rgba(255,255,255,0.2); text-align: left; position: relative; }
        .signature-section { margin-top: 60px; /* MORE SPACE HERE */ display: flex; justify-content: space-between; }
        .signature-block { position: relative; width: 45%; }
        .signature-line { border-bottom: 2px solid #1a0b1a; width: 100%; height: 2px; }
        
        /* Akmal Signature */
        .signature-text { 
            font-family: 'Sacramento', cursive; font-size: 2.5rem; color: #1a0b1a; 
            transform: rotate(-5deg); position: absolute; bottom: 10px; left: 0px;
        }
        /* Alya Input */
        .alya-input {
            border: none; background: transparent; width: 100%; font-family: 'Montserrat', sans-serif; 
            font-size: 1.2rem; color: #555; outline: none; position: absolute; bottom: 5px; left: 0;
        }
        .alya-signed {
            font-family: 'Sacramento', cursive; font-size: 2.5rem; color: #ff4757; 
            transform: rotate(-2deg); pointer-events: none; border: none; bottom: 10px;
        }

        .custom-alert-box { background: #222; border: 1px solid #1DB954; padding: 20px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; color: white; box-shadow: 0 0 30px rgba(29, 185, 84, 0.4); }
        .achievement { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #222; border: 2px solid white; color: white; padding: 15px; width: 90%; max-width: 350px; display: flex; align-items: center; gap: 15px; border-radius: 10px; transition: bottom 0.5s; z-index: 12000; font-family: 'Press Start 2P', cursive; font-size: 0.6rem; text-align: left; box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
        .ach-icon { min-width: 40px; height: 40px; background: #1DB954; border-radius: 5px; }
        .bg-dark { background: radial-gradient(circle at center, #2a2a2a 0%, #121212 100%); }
        .bg-pink { background: radial-gradient(circle at center, #3a1a25 0%, #121212 100%); }
        .bg-cake { background: radial-gradient(circle at center, #1a0b1a 0%, #000 100%); }
    
        /* --- UPDATE: MUSIC CONTROLS --- */
        .music-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .control-btn {
            background: none;
            border: none;
            color: #1DB954; /* Spotify Green */
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .control-btn:hover {
            color: white;
            transform: scale(1.2);
        }

    </style>
</head>
<body onload="startTime()">
    
  <div id="login-screen"style="display: none;">
        <h2 style="margin-bottom: 10px;">Hi, Alya</h2>
        <div style="font-size: 3rem; margin-bottom: 20px;">üë§</div>
        <p style="font-size: 0.8rem; margin-bottom: 10px; color: #777;">Your Important Day (DDMMYYYY)</p>
        <input type="password" id="passcode" class="login-input" placeholder="********">
        <button class="btn-spotify" onclick="attemptLogin()">LOGIN</button>
        <p id="login-error" style="color: #ff4757; margin-top: 10px; display: none;">Wrong password!</p>
    </div> 
    
    <div id="pearl-overlay"style="display: none;">
        <h1 style="color: #ff4757; background: black; padding: 5px 20px;">‚ö†Ô∏è SECURITY ALERT ‚ö†Ô∏è</h1>
        <img src="https://placekitten.com/300/300" class="pearl-img" alt="Pearl"> 
        <h2 id="pearl-status" style="margin-top: 20px;">CHECKING URL SAFETY...</h2>
        <p id="pearl-desc" style="color: #bbb;">Pearl is making sure no weird sites open for Mom.</p>
    </div>

    <div id="custom-alert-overlay">
        <div class="custom-alert-box">
            <h3 style="color: #1DB954; margin-bottom: 10px;">Akmal says:</h3>
            <p>I knew you would say yes! ‚ù§Ô∏è</p>
            <button class="btn-spotify" onclick="closeCustomAlert()" style="margin-top: 15px;">OKAY</button>
        </div>
    </div>

    <div id="secret-unlock-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; justify-content: center; align-items: center;">
    <div class="custom-alert-box" style="background: #191414; padding: 30px; border: 2px solid #1DB954; border-radius: 15px; text-align: center; max-width: 350px; box-shadow: 0 0 20px rgba(29, 185, 84, 0.5);">
        <h3 style="color: #1DB954; margin-bottom: 15px; font-size: 1.5rem;">Akmal says:</h3>
        <p style="color: white; font-size: 1.1rem; margin-bottom: 20px;">Secret Section Unlocked! <br>Scroll down to find it. ‚ù§Ô∏è</p>
        <button class="btn-spotify" onclick="closeSecretAlert()" style="padding: 10px 25px; font-size: 1rem;">OKAY</button>
    </div>
    </div>

    <div id="contract-reveal">
        <canvas id="fireworks-canvas"></canvas>
        <div class="contract-paper" data-aos="zoom-in">
            <h2 style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-top: 0;">‚ù§Ô∏è ETERNAL AGREEMENT</h2>
            <p><strong>Parties:</strong> Akmal & Alya</p>
            <p><strong>Status:</strong> <span id="contract-status">PENDING SIGNATURE...</span></p>
            <hr style="border: 1px dashed #ccc; margin: 20px 0;">
            <div style="line-height: 1.8;">
                <p>1. We fix things together.</p>
                <p>2. We are Player 1 & Player 2 forever.</p>
                <p>3. Distance is temporary. "Us" is permanent.</p>
            </div>
            
            <div class="signature-section">
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <div class="signature-text">Akmal</div>
                </div>
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <input type="text" id="alya-sig-input" class="alya-input" placeholder="Type Name..." autocomplete="off">
                </div>
            </div>

            <button id="contract-btn" class="btn-spotify" style="width: 100%; margin-top: 40px;" onclick="handleContractLogic()">üñãÔ∏è SIGN CONTRACT</button>
        </div>
    </div>

    <div id="fog-modal">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <h3 style="margin-bottom: 10px;">Rub to reveal... üå´Ô∏è</h3>
            <div id="scratch-container">
                <img src="https://placehold.co/300x300/png?text=Hidden+Photo" id="hidden-photo" style="width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0;"> 
                <canvas id="fog-canvas" width="300" height="300" style="position: absolute; top:0; left:0;"></canvas>
            </div>
            <button class="btn-spotify" style="margin-top: 20px;" onclick="closeFog()">CLOSE</button>
        </div>
    </div>

    <div id="flower-toast">Flower Collected! üå∏</div>

    <div id="music-container">
        <div class="music-bar retracted" id="music-bar" onclick="expandMusic()">
    
    <div class="retracted-icon">
        <img id="mini-art" src="https://i1.sndcdn.com/artworks-e0XT6VmlnFJ1-0-t1080x1080.png" style="width: 100%; height: 100%; border-radius: 50%;">
    </div>

    <div class="album-art">
        <img id="track-art" src="https://i1.sndcdn.com/artworks-e0XT6VmlnFJ1-0-t1080x1080.png" style="width: 100%; height: 100%; object-fit: cover;">
    </div>

    <div class="track-info-container">
        <div id="scrolling-wrapper">
            <div id="track-title" style="font-size: 0.8rem; font-weight: bold;">Loading...</div>
            <div id="track-artist" style="font-size: 0.6rem; color: #b3b3b3;">Loading...</div>
        </div>
    </div>

    <div class="controls-group" onclick="event.stopPropagation()">
        <button class="control-btn" onclick="prevSong()" style="font-size: 1rem;">‚èÆ</button>
        <button id="play-btn" class="control-btn" onclick="toggleMusic()" style="font-size: 1.4rem;">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()" style="font-size: 1rem;">‚è≠</button>
    </div>

    <div class="volume-container" onclick="event.stopPropagation()">
        <button class="control-btn" onclick="toggleVolumePopup()">üîä</button>
        
        <div id="vol-popup" class="volume-popup">
            <input type="range" class="vol-slider" orient="vertical" min="0" max="100" value="10" oninput="changeVolume(this.value)">
            <span id="vol-text" style="font-size: 0.6rem; margin-top: 10px; font-weight: bold; color: white;">10</span>
        </div>
    </div>

    <audio id="bg-music"><source src="music.mp3" type="audio/mpeg"></audio>
    <audio id="cake-music" ><source src="cake.mp3" type="audio/mpeg"></audio>
</div>
    </div>
    
    <audio id="secret-sound"><source src="secret-sound.mp3" type="audio/mpeg"></audio>
    <audio id="secret-audio"><source src="secret.mp3" type="audio/mpeg"></audio>
    <audio id="secret-audio1"><source src="secret1.mp3" type="audio/mpeg"> </audio>

    <div id="main-site" style="display: block;">

        <section class="bg-cake" id="cake-section">
    <div class="deco" style="top: 10%; left: 5%;">‚ú®</div>
    <div class="deco" style="bottom: 15%; right: 10%;">üéà</div>
    
    <div data-aos="fade-down" style="font-size: 3rem;">üéâ</div>
    <h1 data-aos="zoom-in" style="margin-bottom: 5px;">Happy Birthday</h1>
    <h1 style="font-size: 3rem; color: #e443a4;" data-aos="zoom-in" data-aos-delay="300">ALYA</h1>
    
    <div class="cake-wrapper">
        <div class="cake">
            <div class="plate"></div>
            <div class="layer layer-bottom"></div>
            <div class="layer layer-middle"></div>
            <div class="layer layer-top"></div>
            <div class="icing"></div>
            <div class="drip drip1"></div>
            <div class="drip drip2"></div>
            <div class="drip drip3"></div>
            <div class="drip drip4"></div>
            <div class="candle c1"><div class="fuego"></div><div class="smoke"></div></div>
            <div class="candle c2"><div class="fuego"></div><div class="smoke"></div></div>
            <div class="candle c3"><div class="fuego"></div><div class="smoke"></div></div>
            <div class="candle c4"><div class="fuego"></div><div class="smoke"></div></div>
            <div class="candle c5"><div class="fuego"></div><div class="smoke"></div></div>
        </div>
    </div>

    <p id="candle-instruction" style="font-size: 0.9rem; opacity: 0.8; margin-top: 130px;">(Blow into mic to extinguish!)</p>
    <button id="mic-btn" class="btn-spotify" style="margin-top: 20px;" onclick="startMicrophone(); playCakeMusic()">üé§ START BLOWING</button>
    <h2 id="wish-msg" style="color: #1DB954; opacity: 0; transition: 1s; margin-top: 20px;">WISH GRANTED! ü•≥</h2>
</section>

        <section id="distance-section">
    <div class="deco" style="top: 5%; right: 5%;">üåç</div>
    <div class="deco" style="bottom: 10%; left: 5%;">üíå</div>

    <div class="bg-distance-color"></div>
    <div class="bg-distance-overlay"></div>

    <div class="distance-content">
        <h2 data-aos="fade-down">The Distance</h2>

        <div class="map-widget" data-aos="zoom-in">
            <svg class="connection-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path class="dashed-path" d="M 15 22 Q 50 10 88 67" />
            </svg>
            <div class="map-pin pin-uae" style="top: 15%; left: 4%;">
                <img src="https://placehold.co/100x100/pink/white?text=Alya" alt="Alya">
                <div class="pin-label">UAE</div>
            </div>
            <div class="map-pin pin-my" style="top: 52%; left: 80%;">
                <img src="https://placehold.co/100x100/1DB954/white?text=Akmal" alt="Akmal">
                <div class="pin-label">MY</div>
            </div>
            <div class="distance-bubble"><span>‚úàÔ∏è</span> 5,600 km</div>
        </div>

        <div class="stats-container" data-aos="fade-up">
            <div class="clock-column">
                <div class="clock-box">
                    <div class="time-text" id="time-uae">00:00</div>
                    <div class="loc-text">UAE (Alya)</div>
                </div>
                <div class="clock-box">
                    <div class="time-text" id="time-my">00:00</div>
                    <div class="loc-text">MY (Akmal)</div>
                </div>
            </div>

            <div class="quest-container">
                <h3 style="text-align: left; margin-bottom: 10px; font-size: 0.9rem;">üìú Quest Log</h3>
                <div class="quest-item quest-done"><div class="quest-checkbox">‚úì</div><div>2019 - 2021: The First Match</div></div>
                <div class="quest-item quest-done"><div class="quest-checkbox">‚úì</div><div>2025: Second Chance Accepted</div></div>
                <div class="quest-item quest-active"><div class="quest-checkbox">‚óè</div><div>Mission: Survive the Distance</div></div>
                <div class="quest-item quest-done"><div class="quest-checkbox">?</div><div>2026+ : Coming Soon</div></div>
            </div>
        </div>

        <div class="ticket-row" data-aos="fade-up">
            <div class="ticket">
                <div class="ticket-left">
                    <div style="font-size: 0.7rem; color: #888;">PASSENGER</div><div class="ticket-val">ALYA</div>
                    <div class="ticket-flight"><span>UAE</span> ‚úàÔ∏è <span>MY</span></div>
                    <div class="ticket-val" style="color: #1DB954;">SOON‚Ñ¢</div>
                </div>
                <div class="ticket-right"><div style="transform: rotate(-90deg); font-weight: bold;">BOARDING</div></div>
            </div>
            <div class="ticket">
                <div class="ticket-left">
                    <div style="font-size: 0.7rem; color: #888;">PASSENGER</div><div class="ticket-val">AKMAL</div>
                    <div class="ticket-flight"><span>MY</span> ‚úàÔ∏è <span>UAE</span></div>
                    <div class="ticket-val" style="color: #1DB954;">SOON‚Ñ¢</div>
                </div>
                <div class="ticket-right"><div style="transform: rotate(-90deg); font-weight: bold;">BOARDING</div></div>
            </div>
        </div>

        <button class="btn-spotify night-mode-btn" onclick="toggleNightMode()">üåò Night Mode</button>
    </div>
</section>

        <section class="bg-dark">
             <div class="deco" style="top: 10%; left: 10%;">üéß</div>
            <div class="deco" style="bottom: 10%; right: 10%;">üéµ</div>

            <div class="wrapped-card" data-aos="zoom-in">
                <div>
                    <div style="font-size: 2.2rem; font-weight: 900;">Our Journey</div>
                    <div style="margin-top: 5px; opacity: 0.9;">Artists</div>
                    <div style="font-size: 1.2rem; font-weight: bold;">Akmal & Alya</div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div style="opacity: 0.9; font-size: 2.6rem; font-weight: 1000; color: #fdfdfd;">Day</div>
                    <div style="opacity: 0.9; font-size: 1rem; font-weight: 1000; color: #fdfdfd;">Since 2nd Chance ‚ù§Ô∏è</div>
                    <div id="days-together-counter" style="font-size: 2.5rem; font-weight: 900; color: #1DB954;">Loading...</div>
                    <div id="total-hours-minutes" class="counter-subtext">Loading hours...</div>
                    <div class="counter-subtext" style="margin-top: 5px;">(Since 12.04.2025)</div>
                </div>

                <div>
                    <div style="opacity: 0.9; font-size: 1rem;">Next Countdown</div>
                    <div id="next-countdown-timer" style="font-size: 1.3rem; font-weight: bold; font-family: 'Courier Prime'; margin-top: 5px;">Loading...</div>
                </div>
                <div style="position: absolute; bottom: -20px; right: -20px; font-size: 10rem; opacity: 0.1;">‚ù§Ô∏è</div>
            </div>
        </section>

        <section class="bg-dark">
            <div class="deco" style="top: 5%; right: 15%;">üì∏</div>
            <h1 data-aos="fade-right">Daily Dose</h1>
            <div class="dose-box" style="position: relative; z-index: 5;">
                <div id="love-display" style="min-height: 60px; color: #1DB954; font-family: 'Courier Prime'; display: flex; align-items: center; justify-content: center; text-align: center; margin-bottom: 20px; font-size: 1.1rem;">Click below...</div>
                <button class="btn-spotify" onclick="generateLove()">GENERATE REASON üé≤</button>
            </div>
            
            <p style="margin-top: 20px; font-size: 1.1rem;">How are you feeling?</p>
            <div class="mood-ring" style="position: relative; z-index: 5;">
                <div class="mood-item">
                    <div class="mood-btn" onclick="changeMood('happy')">‚òÄÔ∏è</div>
                    <span class="mood-tooltip">I'm Happy!</span>
                </div>
                <div class="mood-item">
                    <div class="mood-btn" onclick="changeMood('tired')">‚òÅÔ∏è</div>
                    <span class="mood-tooltip">I'm Tired...</span>
                </div>
                <div class="mood-item">
                    <div class="mood-btn" onclick="changeMood('miss')">üåô</div>
                    <span class="mood-tooltip">Miss You :(</span>
                </div>
            </div>
            <p id="mood-response" style="color: #1DB954; font-family: 'Courier Prime'; min-height: 25px; margin-top: 15px; font-size: 0.9rem;"></p>

            <button class="btn-spotify" onclick="openFog()" style="margin-top: 25px;">üå´Ô∏è FOGGY WINDOW</button>
        </section>

        <section class="bg-pink">
            <div class="deco" style="top: 10%; left: 5%;">üñºÔ∏è</div>
             <h1 data-aos="fade-down">Our Memories</h1>
             <div class="gallery-grid" data-aos="fade-up" style="margin-top: 20px;">
                <img src="https://placehold.co/200x200/pink/white?text=Us+1" class="gallery-img">
                <img src="https://placehold.co/200x200/pink/white?text=Us+2" class="gallery-img">
                <img src="https://placehold.co/200x200/pink/white?text=Us+3" class="gallery-img">
                <img src="https://placehold.co/200x200/pink/white?text=Silly" class="gallery-img">
            </div>
        </section>

        <section class="bg-pink">
             <div class="deco" style="top: 15%; left: 5%;">ü¶ã</div>
            <div class="deco" style="bottom: 20%; right: 5%;">üêù</div>

            <h1 style="color: #ff4757;">Your Garden üå∏</h1>
            <p style="font-size: 0.9rem; margin-top: 5px;">(Tap to plant, Tap flower to collect!)</p>
            <button class="btn-spotify btn-pink" onclick="plantFlower()">PLANT FLOWER üå±</button>
            <div id="garden"></div>
        </section>

        <section style="background: radial-gradient(circle, #2c3e50 0%, #000000 100%);">
             <div class="deco" style="top: 10%; right: 10%;">üì°</div>
            <div class="deco" style="bottom: 10%; left: 10%;">üí´</div>

            <h1 data-aos="fade-down">Voice Capsule</h1>
            <p data-aos="fade-in">I left a message here for you.</p>
            <div class="voice-capsule" onclick="playVoice()">
                <div style="font-size: 3.5rem;">üéôÔ∏è</div>
                <div class="voice-waves"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </div>
            <p id="voice-text" style="margin-top: 20px; font-size: 0.9rem; opacity: 0;">Playing...</p>
            <audio id="voice-msg"><source src="voice.mp3" type="audio/mpeg"></audio>
        </section>

        <section style="background: black;">
             <div class="deco" style="top: 20%; left: 20%;">‚ùî</div>
            <div class="deco" style="bottom: 20%; right: 20%;">üíñ</div>
            <div class="deco" id="secret-deco" style="bottom: 30%; " onclick="playSecretSound()">üß∏</div>

            <h1 data-aos="zoom-in">One Last Question...</h1>
            <p data-aos="fade-in" style="margin-bottom: 40px; font-size: 1.2rem;">Do you believe in us?</p>
            <div style="display: flex; gap: 30px;">
                <button class="btn-spotify" style="background: #333; color: #fff; padding: 15px 40px;" onclick="showAkmalAlert()">YES</button>
                <button class="btn-spotify" style="background: #1DB954; transform: scale(1.2); padding: 15px 40px;" onclick="triggerFinale()">ALWAYS</button>
            </div>
        </section>

        <section id="secret-section">
            <h1 style="color: #1DB954;">Secret Unlocked üîì</h1>
            <p>You found the hidden part!</p>
            <p style="font-size: 0.9rem; opacity: 0.8;">Here is your special Wrapped Video:</p>
            <div style="width: 95%; max-width: 450px; height: 280px; background: black; border-radius: 12px; margin: 30px auto; overflow: hidden; display: flex; justify-content: center; align-items: center; border: 2px solid #333;">
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/YOUR_VIDEO_ID" frameborder="0" allowfullscreen style="border-radius: 12px;"></iframe>
            </div>
            <p style="margin-top: 30px;">(P.S. There might be more hidden in the fog...)</p>
        </section>

    </div>

    <div id="achievement" class="achievement">
        <div class="ach-icon"></div>
        <div>
            <div style="color: #ffff00; font-size: 0.6rem;">SECRET UNLOCKED</div>
            <div style="font-size: 0.7rem;">"It was never a website.<br>It was a promise."</div>
        </div>
    </div>

    <script>

        /* --- MUSIC CAKE --- */
        function playCakeMusic() {
        const bgMusic = document.getElementById('bg-music');
        const cakeMusic = document.getElementById('cake-music');
        
        // 1. Pause the main background music
        if(bgMusic && !bgMusic.paused) {
            bgMusic.pause();
            document.getElementById('play-btn').innerText = "‚ñ∂"; // Reset main play button UI
        }

        // 2. Play the birthday cake music
        if(cakeMusic) {
            cakeMusic.volume = 0.10;
            cakeMusic.currentTime = 0; // Start from beginning
            cakeMusic.play().then(() => {
                console.log("Birthday music started via button!");
            }).catch(e => {
                console.log("Error playing cake music:", e);
            });
        }
    }

        // --- STOP MUSIC ON SCROLL ---
        const cakeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                // If user LEAVES the cake section (isIntersecting is false)
                if (!entry.isIntersecting) {
                    const cakeMusic = document.getElementById('cake-music');

                    // 1. Stop Birthday Music
                    if (cakeMusic && !cakeMusic.paused) {
                        console.log("üëã Left Cake Zone - Stopping Birthday Music");
                        cakeMusic.pause();
                        cakeMusic.currentTime = 0; // Reset
                    }

                    // 2. Resume Main Background Music (if it was paused)
                    if (bgMusic && bgMusic.paused) {
                        bgMusic.volume = 0.02; // Restore volume
                        bgMusic.play().catch(e => console.log("Bg music resume error", e));
                        document.getElementById('play-btn').innerText = "‚è∏";
                    }
                }
            });
        }, { threshold: 0.1 });

        // Start watching the cake section
        const cakeSec = document.getElementById('cake-section');
        if (cakeSec) { cakeObserver.observe(cakeSec); }

        /* --- AUTO-SWAP MUSIC ON SCROLL --- */

            // 1. Select the elements
            const cakeSection = document.querySelector('.bg-cake');
            const bgMusic = document.getElementById('bg-music');
            const cakeMusic = document.getElementById('cake-music');

            // 2. Define the "DJ" Sensor
            const musicObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    
                    // CASE A: User enters the Cake Section
                    if (entry.isIntersecting) {
                        
                        // 1. Pause Main Playlist
                        if (!bgMusic.paused) {
                            bgMusic.pause();
                            document.getElementById('play-btn').innerText = "‚ñ∂"; // Update UI
                        }

                        // 2. Play Birthday Track
                        cakeMusic.volume = 0.3; // Set volume
                        cakeMusic.play().catch(e => console.log("Audio waiting for interaction"));
                    } 
                    
                    // CASE B: User scrolls AWAY from Cake Section
                    else {
                        
                        // 1. Stop Birthday Track
                        if (!cakeMusic.paused) {
                            cakeMusic.pause();
                            cakeMusic.currentTime = 0; // Reset to start
                        }

                        // 2. Resume Main Playlist (if it was loaded)
                       
                    }
                });
            }, { threshold: 0.3 }); // Swaps when 30% of cake section is visible

            // NOTE: Ensure your 'attemptLogin' function still observes the section:
            // if (cakeSection) { musicObserver.observe(cakeSection); }


        /* --- UPDATED LOGIN FUNCTION --- */
        function attemptLogin() {
            // Check password
            if(document.getElementById('passcode').value === '15042005') {
                
                // Hide Login
                document.getElementById('login-screen').style.display = 'none';
                
                // Show Security Check (Pearl)
                document.getElementById('pearl-overlay').style.display = 'flex';
                
                setTimeout(() => {
                    // Hide Security Check
                    document.getElementById('pearl-overlay').style.display = 'none';
                    
                    // Show Main Site
                    document.getElementById('main-site').style.display = 'block';
                    
                    // Init Animations
                    AOS.init({ duration: 800 });

                    // *** NEW: Start the Music Sensor Now ***
                    // We do this here because the user has now clicked "Login", 
                    // so the browser allows audio to play.
                    if (cakeSection) {
                        musicObserver.observe(cakeSection);
                    }

                }, 3000);
            } else { 
                document.getElementById('login-error').style.display = 'block'; 
            }
        }

        /* --- UPDATED MUSIC LOGIC --- */
        const playlist = [
            {
                title: "Tower of Memories", 
                artist: "IVRY",
                src: "music.mp3", 
                art: "https://i1.sndcdn.com/artworks-e0XT6VmlnFJ1-0-t1080x1080.png"
            },
            {
                title: "A Very Long Song Title To Test The Scrolling Feature",
                artist: "Test Artist",
                src: "song2.mp3",
                art: "https://placehold.co/100x100/1DB954/white?text=Music"
            }
        ];

        let currentTrackIdx = 0;
        const audio = document.getElementById('bg-music');
        const playBtn = document.getElementById('play-btn');
        const titleEl = document.getElementById('track-title');
        const artistEl = document.getElementById('track-artist');
        const artEl = document.getElementById('track-art');
        const miniArtEl = document.getElementById('mini-art');
        const scrollWrapper = document.getElementById('scrolling-wrapper');

        // 1. Set Initial Volume to 10%
        audio.volume = 0.02; 

        // Initialize
        loadSong(currentTrackIdx);

        function loadSong(index) {
            const track = playlist[index];
            audio.src = track.src;
            titleEl.innerText = track.title;
            artistEl.innerText = track.artist;
            artEl.src = track.art;
            miniArtEl.src = track.art;
            
            checkScroll();

            if(index !== 0 || !audio.paused) {
                audio.play();
                playBtn.innerText = "‚è∏";
                document.getElementById('music-bar').classList.remove('retracted');
            }
        }

        function checkScroll() {
            scrollWrapper.classList.remove('scrolling-text');
            void scrollWrapper.offsetWidth; // Trigger reflow
            
            // Check length to decide if we scroll
            if (titleEl.innerText.length > 12) {
                scrollWrapper.classList.add('scrolling-text');
                scrollWrapper.style.paddingLeft = "100%"; 
            } else {
                scrollWrapper.style.paddingLeft = "0"; 
                scrollWrapper.style.position = "static";
            }
        }

        function toggleMusic() {
            if (audio.paused) {
                audio.play();
                playBtn.innerText = "‚è∏";
                document.getElementById('music-bar').classList.remove('retracted');
            } else {
                audio.pause();
                playBtn.innerText = "‚ñ∂";
            }
        }

        function nextSong() {
            currentTrackIdx = (currentTrackIdx + 1) % playlist.length;
            loadSong(currentTrackIdx);
        }

        function prevSong() {
            currentTrackIdx = (currentTrackIdx - 1 + playlist.length) % playlist.length;
            loadSong(currentTrackIdx);
        }

        // Volume Popup Logic
        function toggleVolumePopup() {
            const popup = document.getElementById('vol-popup');
            // Toggle class 'show' to trigger CSS display flex
            if (popup.classList.contains('show')) {
                popup.classList.remove('show');
            } else {
                popup.classList.add('show');
            }
        }

        function changeVolume(val) {
            audio.volume = val / 100;
            document.getElementById('vol-text').innerText = val;
        }

        // Close volume popup if clicking elsewhere
        document.addEventListener('click', function(e) {
            const volContainer = document.querySelector('.volume-container');
            if (!volContainer.contains(e.target)) {
                document.getElementById('vol-popup').classList.remove('show');
            }
        });

        audio.addEventListener('ended', nextSong);

        // --- CONFIG DATE ---
        // CHANGE THIS TO YOUR START DATE (YYYY-MM-DD)
        const startDate = new Date("2025-04-12"); // Updated date per request
        const nextBirthday = new Date("April 15, 2026 00:00:00").getTime();

    const reasons = [
    // Your Top 10 Picks
        "My moon follows your sun.",
        "You are my 'mov', unique and irreplaceable.",
        "I can‚Äôt imagine my life without you.",
        "You stole my heart (twice).",
        "Loving you is the best decision I ever made.",
        "I want to be your home.",
        "I want to make up for all the time we spent apart.",
        "You are my safe space.",
        "You are the missing piece I was looking for.",
        "You listen to me when no one else does.",

    // The Rest of the 100
        "The distance means nothing compared to what I feel for you.",
        "You are worth every second of the 4-hour time difference.",
        "You‚Äôre the last thing I think of before I sleep.",
        "Waiting for you is the easiest thing I‚Äôd ever do.",
        "Every 'Good morning' from you makes my day instantly better.",
        "The way we bridge the distance with just our voices.",
        "Knowing that one day, that plane ticket will be one-way.",
        "You make a phone screen feel like home.",
        "Even far away, you feel closer than anyone else.",
        "Looking at the moon and knowing you see it too comforts me.",
        "We defied the odds of distance.",
        "You are my favorite notification.",
        "Counting down the days to see you is my favorite hobby.",
        "You make the miles disappear when we laugh together.",
        "We found our way back to each other.",
        "You gave us a second chance in 2025.",
        "You proved that what‚Äôs meant to be will always find a way.",
        "You didn't give up on 'us'.",
        "We grew up, but we didn't grow apart.",
        "The timing was finally right.",
        "You forgave the past so we could have a future.",
        "Falling for you the second time was even better than the first.",
        "You are my proof that destiny exists.",
        "You‚Äôre my favorite duo partner.",
        "Gaming with you is the highlight of my night.",
        "Even when we lose, I have fun if it's with you.",
        "Your cute gamer rage.",
        "You heal me in games and in real life.",
        "We make the best team.",
        "The silly noises you make when you concentrate.",
        "You challenge me to be better.",
        "Our late-night Discord calls.",
        "You actually get my jokes (mostly).",
        "You‚Äôre my Player 2 for life.",
        "Your beautiful smile.",
        "The sound of your laugh.",
        "Your endless kindness.",
        "You are effortlessly beautiful.",
        "Your voice‚Äîit calms my storms.",
        "Your eyes (I could get lost in them).",
        "You are strong, even when things get tough.",
        "Your amazing sense of style.",
        "You are incredibly smart.",
        "The way you care for the people you love.",
        "You are my 'silly' girl.",
        "Your ambition and drive.",
        "You are so brave.",
        "How cute you are when you're sleepy.",
        "Your taste in music.",
        "You make even the boring days exciting.",
        "You inspire me every day.",
        "You handle my moods with patience.",
        "You are my peace in a chaotic world.",
        "You make me want to be a better man.",
        "You support my dreams.",
        "You understand me without me saying a word.",
        "You cheer me up when I‚Äôm down.",
        "You give me a reason to work harder.",
        "You believe in me.",
        "You make me feel truly loved.",
        "You are my best friend.",
        "Life is just brighter with you in it.",
        "I can be my true self around you.",
        "You accept my flaws.",
        "You handle my 'silly me' moments perfectly.",
        "You make my heart beat faster.",
        "I want to travel the world with you.",
        "I want to build a PC next to yours one day.",
        "I want to cook for you.",
        "I want to hold your hand for real.",
        "I see a future in your eyes.",
        "I want to grow old with you.",
        "I promise to always try my best for you.",
        "I want to be the reason you smile every day.",
        "I want to celebrate every birthday with you.",
        "You are the only one I want to annoy for the rest of my life.",
        "I want to learn new things with you.",
        "Your random bursts of energy.",
        "The way you tell stories.",
        "The way you text back.",
        "You are simply amazing.",
        "You are my sunshine.",
        "You are perfect to me.",
        "I love everything about you.",
        "You are my dream come true.",
        "Every love song reminds me of you now.",
        "You are you.",
        "I love you more than words can say."
        ];

        let progress = { flowers: 0, fog: false, night: false, reasons: 0 };
        let achievementUnlocked = false;
        let scratchedPixels = 0;
        let isSigned = false; // For contract

        function checkARG() {
            if(achievementUnlocked) return;
            if(progress.flowers >= 5 && progress.reasons >= 10 && progress.fog && progress.night) {
                achievementUnlocked = true;
                const ach = document.getElementById('achievement');
                ach.style.bottom = "20px";
                setTimeout(() => { ach.style.bottom = "-100px"; }, 5000);
            }
        }

        // CURSOR TRAIL LOGIC
        document.addEventListener('mousemove', function(e) {
            // Limit creation rate to avoid lag
            if (Math.random() < 0.1) { // 10% chance per move event
                const heart = document.createElement('div');
                heart.classList.add('cursor-heart');
                heart.innerText = "üíñ"; // Sparkle or Heart
                heart.style.left = e.pageX + 'px';
                heart.style.top = e.pageY + 'px';
                document.body.appendChild(heart);

                setTimeout(() => {
                    heart.remove();
                }, 1000);
            }
        });

        // MUSIC & VOLUME & RETRACTABLE LOGIC
        document.addEventListener("DOMContentLoaded", () => {
            const audio = document.getElementById('bg-music');
            audio.volume = 0.05; 
        });

        function expandMusic() {
            const bar = document.getElementById('music-bar');
            bar.classList.remove('retracted');
        }

        // Click outside to retract
        document.addEventListener('click', function(event) {
            const bar = document.getElementById('music-bar');
            const container = document.getElementById('music-container');
            if (!container.contains(event.target)) {
                bar.classList.add('retracted');
            }
        });

        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            const btn = document.getElementById('play-btn');
            const bar = document.getElementById('music-bar');
            
            if (audio.paused) { 
                audio.play(); 
                btn.innerText = "‚è∏"; 
                bar.classList.remove('retracted'); // Ensure it stays open when playing
            } else { 
                audio.pause(); 
                btn.innerText = "‚ñ∂"; 
            }
        }
        function changeVolume(val) {
            const audio = document.getElementById('bg-music');
            audio.volume = val / 100; 
        }

        // SPOTIFY LIVE TIMERS (UPDATED)
        setInterval(() => {
            const now = new Date().getTime();
            
            // 1. Days, Hours, Minutes Together
            const timeDiff = now - startDate.getTime();
            const totalMinutes = Math.floor(timeDiff / (1000 * 60));
            const totalHours = Math.floor(timeDiff / (1000 * 60 * 60));
            const daysTogether = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            document.getElementById("days-together-counter").innerText = `${daysTogether}`;
            document.getElementById("total-hours-minutes").innerText = `(${totalHours.toLocaleString()} hours, ${totalMinutes.toLocaleString()} mins)`;


            // 2. Next Countdown
            const distance = nextBirthday - now;
            if (distance < 0) {
                document.getElementById("next-countdown-timer").innerText = "Happy Birthday!";
            } else {
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById("next-countdown-timer").innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
        }, 1000);

        // LOGIN
        function attemptLogin() {
            if(document.getElementById('passcode').value === '15042005') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('pearl-overlay').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('pearl-overlay').style.display = 'none';
                    document.getElementById('main-site').style.display = 'block';
                    AOS.init({ duration: 800 });
                }, 3000);
            } else { document.getElementById('login-error').style.display = 'block'; }
        }

        // --- NEW: MICROPHONE BLOW DETECTION ---
        function startMicrophone() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const microphone = audioContext.createMediaStreamSource(stream);
                const scriptProcessor = audioContext.createScriptProcessor(2048, 1, 1);

                analyser.smoothingTimeConstant = 0.8;
                analyser.fftSize = 1024;

                microphone.connect(analyser);
                analyser.connect(scriptProcessor);
                scriptProcessor.connect(audioContext.destination);

                scriptProcessor.onaudioprocess = function() {
                    const array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    let values = 0;
                    for (let i = 0; i < array.length; i++) {
                        values += array[i];
                    }

                    const average = values / array.length;

                    // THRESHOLD MET (BLOW DETECTED)
                    if (average > 40) {
                        
                        // 1. Visuals: Extinguish Flames
                        document.querySelectorAll('.fuego').forEach(f => {
                            f.style.opacity = '0';
                            f.style.animation = 'none';
                        });
                        document.querySelectorAll('.smoke').forEach(s => {
                            s.style.opacity = '1';
                            s.style.animation = 'smokeRise 1s forwards';
                        });

                        // 2. UI Updates
                        document.getElementById('wish-msg').style.opacity = '1';
                        const btn = document.getElementById('mic-btn');
                        btn.innerText = "WISH GRANTED! üéÇ";
                        btn.disabled = true;
                        btn.style.backgroundColor = "#555";

                        // 3. TRIGGER CONFETTI (The missing part!)
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 },
                            colors: ['#ff4757', '#1DB954', '#ffffff'] // Red, Green, White
                        });

                        // 4. PLAY CLAP SOUND (Optional)
                        // If you have a clap.mp3, uncomment the next line:
                        // new Audio('clap.mp3').play();

                        // 5. Cleanup
                        stream.getTracks().forEach(track => track.stop());
                        scriptProcessor.disconnect();
                        audioContext.close();
                    }
                };
            }).catch(function(err) {
                console.error("Mic Error:", err);
                alert("Microphone access needed! Please allow access.");
            });
        } else {
            alert("Your browser doesn't support microphone access.");
        }
    }


        // TIME
        function startTime() {
         const updateTime = () => {
        const now = new Date();
        const myTimeStr = now.toLocaleTimeString('en-US', { timeZone: 'Asia/Kuala_Lumpur', hour: '2-digit', minute: '2-digit', hour12: false });
        const uaeTimeStr = now.toLocaleTimeString('en-US', { timeZone: 'Asia/Dubai', hour: '2-digit', minute: '2-digit', hour12: false });
        
        document.getElementById('time-my').innerText = myTimeStr;
        document.getElementById('time-uae').innerText = uaeTimeStr;

        const myHour = parseInt(myTimeStr.split(':')[0]);
        const bg = document.querySelector('.bg-distance-color');
        
        // Background changes, but TEXT COLOR lines are removed so it stays white/gray from CSS
        if (myHour >= 6 && myHour < 11) { 
            bg.style.background = "linear-gradient(135deg, #fce38a, #f38181)"; 
        } 
        else if (myHour >= 11 && myHour < 17) { 
            bg.style.background = "linear-gradient(135deg, #2980B9, #6DD5FA, #FFFFFF)"; 
        } 
        else if (myHour >= 17 && myHour < 19) { 
            bg.style.background = "linear-gradient(135deg, #cc2b5e, #753a88)"; 
        } 
        else { 
            bg.style.background = "linear-gradient(135deg, #0f0c29, #302b63, #24243e)"; 
        }
    };
    setInterval(updateTime, 1000); 
    updateTime();
}

        // FOG (Soft & Auto-Reveal)
        function openFog() {
            document.getElementById('fog-modal').style.display = 'flex';
            initCanvas();
        }
        function closeFog() { document.getElementById('fog-modal').style.display = 'none'; }
        function initCanvas() {
            const canvas = document.getElementById('fog-canvas'); const ctx = canvas.getContext('2d');
            const container = document.getElementById('scratch-container');
            canvas.style.opacity = 1; container.classList.remove('fog-glow'); scratchedPixels = 0;
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = "rgba(200, 200, 200, 0.9)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.font = "20px Arial"; ctx.fillStyle = "#555"; ctx.fillText("Rub me!", 110, 150);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.shadowBlur = 20; ctx.shadowColor = "rgba(0,0,0,1)"; // Soft brush
            
            let isDrawing = false;
            function scratch(x, y) { 
                ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI * 2, false); ctx.fill();
                scratchedPixels++;
                if(scratchedPixels > 150 && !progress.fog) { // Approx threshold
                      canvas.style.transition = "opacity 1s"; canvas.style.opacity = 0;
                      container.classList.add('fog-glow');
                      progress.fog = true; checkARG();
                }
            }
            canvas.addEventListener('mousedown', () => isDrawing = true); canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mousemove', (e) => { if (isDrawing) { const rect = canvas.getBoundingClientRect(); scratch(e.clientX - rect.left, e.clientY - rect.top); } });
            canvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); }); canvas.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('touchmove', (e) => { if (isDrawing) { const rect = canvas.getBoundingClientRect(); const touch = e.touches[0]; scratch(touch.clientX - rect.left, touch.clientY - rect.top); } });
        }

        // UTILS
        function toggleNightMode() { document.body.classList.toggle('night-mode-active'); progress.night = true; checkARG(); }
        
        function plantFlower() {
        const garden = document.getElementById('garden');
        const flowers = ['üå∑', 'üå∏', 'üå∫', 'üåπ'];
        const flower = document.createElement('div');
        
        // SECRET SUNFLOWER CHANCE (20%)
        const isSecret = Math.random() < 0.2; 
        flower.innerText = isSecret ? 'üåª' : flowers[Math.floor(Math.random() * flowers.length)];
        
        flower.classList.add('flower');
        flower.style.left = Math.random() * 90 + '%';
        
        flower.onclick = function(e) {
            
            // 1. Handle Secret Flower Logic
            if(isSecret) {
                // *** CHANGE HERE: Look for 'secret-audio1' ***
                const secretAudio = document.getElementById('secret-audio1');
                if(secretAudio) {
                    secretAudio.volume = 0.5;
                    secretAudio.play().catch(e => console.log("Audio play error", e));
                }
                
                // Show popup
                const overlay = document.getElementById('sunflower-overlay');
                if(overlay) overlay.style.display = 'flex';
            } 

            // 2. Visual Effects (+1 Animation)
            const plusOne = document.createElement('div'); 
            plusOne.innerText = "+1"; 
            plusOne.classList.add('plus-one');
            plusOne.style.left = e.clientX + 'px'; 
            plusOne.style.top = e.clientY + 'px'; 
            document.body.appendChild(plusOne);
            
            const toast = document.getElementById('flower-toast'); 
            if(toast) {
                toast.style.opacity = '1';
                setTimeout(() => { toast.style.opacity = '0'; }, 1000); 
            }
            
            setTimeout(() => { plusOne.remove(); }, 1000);
            
            // 3. Remove flower
            this.remove();
            
            // 4. Update Progress
            if(typeof progress !== 'undefined') {
                progress.flowers++; 
                checkARG();
            }
        };
        garden.appendChild(flower);
    }

        // SECRET DECO SOUND
        function playSecretSound() {
             const secretSound = document.getElementById('secret-sound');
             secretSound.volume = 0.5;
             secretSound.play();
             alert("You found the secret teddy bear! üß∏");
        }
        
        // ALERTS
        function showAkmalAlert() { document.getElementById('custom-alert-overlay').style.display = 'flex'; }
        function closeCustomAlert() { document.getElementById('custom-alert-overlay').style.display = 'none'; }
        function closeSecretAlert() {document.getElementById('secret-unlock-overlay').style.display = 'none';}

        // TYPING
        let currentTimeout; 
        function generateLove() {
            const display = document.getElementById('love-display');
            const randomMsg = reasons[Math.floor(Math.random() * reasons.length)];
            if(currentTimeout) clearTimeout(currentTimeout);
            display.innerText = ""; 
            let i = 0;
            function typeWriter() {
                if (i < randomMsg.length) {
                    display.innerHTML += randomMsg.charAt(i); i++;
                    currentTimeout = setTimeout(typeWriter, 5); 
                }
            }
            typeWriter();
            progress.reasons++; checkARG();
        }

        // VOICE
        function playVoice() {
            const audio = document.getElementById('voice-msg');
            const capsule = document.querySelector('.voice-capsule');
            const txt = document.getElementById('voice-text');
            if(audio.paused) {
                document.getElementById('bg-music').pause();
                audio.play();
                capsule.classList.add('voice-active');
                txt.style.opacity = '1';
                audio.onended = function() { capsule.classList.remove('voice-active'); txt.style.opacity = '0'; document.getElementById('bg-music').play(); };
            } else { audio.pause(); capsule.classList.remove('voice-active'); }
        }

        // CONTRACT LOGIC (NEW)
        function triggerFinale() {
             document.getElementById('contract-reveal').style.display = 'flex';
        }

        function handleContractLogic() {
            const input = document.getElementById('alya-sig-input');
            const btn = document.getElementById('contract-btn');
            const status = document.getElementById('contract-status');

            if (!isSigned) {
                if(input.value.trim() === "") {
                    alert("Please sign your name first! ‚úçÔ∏è");
                    return;
                }
                
                // Style input to look like signature
                input.classList.add('alya-signed');
                input.disabled = true;
                
                // Update Status
                status.innerHTML = "<span style='color:#1DB954'>SIGNED & SEALED ‚ù§Ô∏è</span>";
                
                // Trigger Confetti (Fireworks)
                document.getElementById('fireworks-canvas').style.display = 'block';
                var duration = 3 * 1000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 12000 };
                function randomInRange(min, max) { return Math.random() * (max - min) + min; }
                var interval = setInterval(function() {
                    var timeLeft = animationEnd - Date.now();
                    if (timeLeft <= 0) { return clearInterval(interval); }
                    var particleCount = 50 * (timeLeft / duration);
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
                }, 250);

                // Update Button
                btn.innerText = "I LOVE YOU ‚ù§Ô∏è";
                btn.style.background = "#ff4757";
                btn.style.transform = "scale(1.1)";
                isSigned = true;

            } else {
                // Unlock Secret
                unlockSecret();
            }
        }

        // SECRET UNLOCK
        function unlockSecret() {
            // 1. Hide the old stuff
            document.getElementById('contract-reveal').style.display = 'none';
            document.getElementById('fireworks-canvas').style.display = 'none';
            
            // 2. Show the Secret Section
            const secretSec = document.getElementById('secret-section');
            secretSec.style.display = 'flex'; 
            secretSec.scrollIntoView({ behavior: 'smooth' });

            // 3. SHOW THE CUSTOM POPUP (Instead of alert)
            document.getElementById('secret-unlock-overlay').style.display = 'flex';
            
            // Optional: Play a sound effect if you have one
            // new Audio('secret.mp3').play();
        }

        // MOOD LOGIC (UPDATED FOR TOOLTIPS & CENTER CONFETTI)
        function changeMood(mood) {
            const resp = document.getElementById('mood-response');
            if(mood === 'happy') {
                resp.innerText = "I'm glad you're smiling today. Keep shining! ‚ú®";
                // Confetti from center screen (behind box)
                confetti({ colors: ['#ff4757', '#ffffff'], origin: { x: 0.5, y: 0.5 }, zIndex: 1 }); 
            } else if(mood === 'tired') {
                resp.innerText = "Take a deep breath. You're doing amazing, Alya. ‚òÅÔ∏è";
            } else {
                resp.innerText = "I miss you more. Not long now until MY ‚úàÔ∏è UAE.";
            }
        } 

        
        

    </script>
</body>
</html>
